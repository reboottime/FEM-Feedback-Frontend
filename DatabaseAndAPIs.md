## Database Design

### Application Needs

- Data Field requirements
  - A comment content has a max length of 1500 characters
  - A suggestion content has a max length of 1500 characters
  - A suggestion can have as many as 100 comments
  - A suggestion can have as max as 1000 votes
- Requirements from the API (design) side
  - Queried by `feedbacks`
    - Other than feedback metadata
    - Supports sorted queries by fields - votes, comments
    - Supports filter by author
    - Supports filter by a category
    - Supports filter by status
  - Statisticize feedback status
- Requirements from the product side: this is a sample project, so there is no need to consider the data model & application extension needs.

### Entity Relationships

**1. Relationships analysis**

- A user can have multiple suggestions, yet a suggestion can have one author only
- A user can have multiple comments, yet a comment can have one author only
- A suggestion can have multiple votes, yet a vote can have one suggestion only
- A comment can have multiple subordinate comments, yet a comment can have a parent comment at most

**2. Conclusion**

- user & suggestion: 1 to N
- user & vote: 1 to N
- user & comments: 1 to N
- vote and suggestion: 1 to N
- vote and user: 1 to N

---

**References**

1. Database Design Process: https://www.youtube.com/watch?v=7m6gXeMDaHc&ab_channel=NesoAcademy
2. Data Modeling with MongoDB: https://www.youtube.com/watch?v=3GHZd0zv170&ab_channel=MongoDB

---

### Schema design

As the requirement comes from API design/ and the product side are super simple, so the way to handle the relationship between Votes, Comments, and Suggestions is embedding, not linking.

- Feedback

```ts
interface ISuggestion {
  author: IUser; // long text
  comment_count: number; // embedded votes, stores author id mainly
  comments: IComment[]; // embedded user metadata, created by okta, stored in a database
  detail: string; // suggestion content, long text
  id: ObjectId; // record id in database
  title: string;
  vote_count: number; // total comment counts, update when a user adds comments
  votes: IVote[]; // total vote count, updated when user cast/revoke vote
}
```

- Comment ( embedded in Suggestion)

```ts
interface IComment {
  author: IUser; // embedded user metadata, created by okta, stored in the database
  content: string; // long text
  createdAt: timestamp; // generated by MongoDB, this is needed as we want to sort comments in desc way by the time
  replyTo?: string; // optional, if the `replyTo` exists that means this comment is a sub comment
  updatedAt: timestamp; // generated by MongoDB
}
```

- Vote ( embedded in Suggestion)

```ts
interface IVote {
  author: IUser["id"]; // the user id
}
```

- User

```ts
interface IUser {
  avatar: string; // given default value at the first time you registered the system
  firstName: string;
  lastName: string;
  roles: string[];
}
```
